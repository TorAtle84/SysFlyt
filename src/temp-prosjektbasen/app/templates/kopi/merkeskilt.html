{% extends 'base.html' %}

{% block title %}Generer merkeskilt{% endblock %}

{% block content %}
<style>
  /* --------------------------------------------------
     Styling for klikkbare segmenter {byggnr},{system},{komponent},{typekode}
     -------------------------------------------------- */
  .segment {
    display: inline-block;
    margin: 0 0.30rem;
    padding: 0.8rem 0.6rem;
    border: 1.5px solid #ccc;
    border-radius: 14px;
    background-color: #f5f5f5;
    cursor: pointer;
    font-weight: 600;
    color: #333;
    user-select: none;
  }
  .segment.selected {
    background-color: #004a9f;
    color: #fff;
    border-color: #004a9f;
  }
  .format-input {
    width: 100%;
    font-family: monospace;
    padding: 0.5rem;
    border: 1px solid #ccc;
    border-radius: 4px;
    margin-bottom: 0.5rem;
    font-size: 0.95rem;
  }

  /* --------------------------------------------------
     Styling for system‐kriterie‐knapper (1–9)
     -------------------------------------------------- */
  .sys-btn {
    display: inline-block;
    margin: 0 0.15rem;
    padding: 0.6rem 0.5rem;
    border: 1.5px solid #ccc;
    border-radius: 50%;
    background-color: #f5f5f5;
    cursor: pointer;
    font-weight: 600;
    width: 2.2rem;
    text-align: center;
    user-select: none;
  }
  .sys-btn.selected {
    background-color: #004a9f;
    color: #fff;
    border-color: #004a9f;
  }
</style>

<h2>Generering av merkeskilt</h2>
<br>

<!-- ───────────────────────────────────────────────────────────────────────────
     1) Format‐segmenter: Klikk på {byggnr}, {system}, {komponent}, {typekode}
     for å bygge ønsket format.
   ─────────────────────────────────────────────────────────────────────────── -->
<div class="mb-3">
  <label><strong>Velg hvilke deler du vil inkludere i formatet:</strong></label><br><br>
  <div id="segmenter">
    <span class="segment" data-placeholder="{byggnr}">+260801A</span>
    <span class="segment" data-placeholder="{system}">=5630.0102</span>
    <span class="segment" data-placeholder="{komponent}">-SQZ5004</span>
    <span class="segment" data-placeholder="{typekode}">%SQZ.0001</span>
  </div>
</div>

<textarea id="egendefinert-format" class="format-input" rows="1" readonly
          placeholder="Klikk på segmentene over for å bygge formatet"></textarea>
<small class="text-muted">
  Bruk <code>{byggnr}</code> for “+…”, <code>{system}</code> for “=…”, 
  <code>{komponent}</code> for “-…” og <code>{typekode}</code> for “%…”.
</small>

<hr>

<div class="row">
  <!-- ─────────────────────────────────────────────────────────────────────────
       VENSTRE KOLONNE: Filopplasting + Systemkriterier + Alternativ tekstliste
     ───────────────────────────────────────────────────────────────────────── -->
  <div class="col-md-5">
    <!-- 2a) Last opp Excel‐filer (flere valgbar) -->
    <h5>Last opp Excel-filer (flere valgbar)</h5>
    <input type="file" id="file-input" multiple accept=".xlsx" class="form-control mb-3">
    <small class="text-muted">Velg én eller flere .xlsx-filer som skal scannes.</small>
    <br><br>

    <!-- 2b) Systemkriterier: Klikk på tall (1–9) for å angi at {system}-delen må starte med dette sifferet -->
    <h5>Systemkriterier</h5>
    <p class="text-muted">Klikk på tallene som det første sifferet i <code>{system}</code> må registreres som:</p>
    <div id="system-kriterier">
      {% for n in range(1,10) %}
        <span class="sys-btn" data-val="{{ n }}">{{ n }}</span>
      {% endfor %}
    </div>

    <hr class="my-3">

    <!-- 2c) Alternativ: Lim inn komponent‐ID‐liste manuelt -->
    <h5>Komponent-ID (alternativt)</h5>
    <textarea id="venstre-tabell" class="form-control" rows="7"
              placeholder="Eller lim inn komponenter her (én per linje)..."></textarea>
    <small class="text-muted">Hvis du limer inn her, vil scanning av fil(er) IKKE kjøres.</small>
  </div>

  <!-- ─────────────────────────────────────────────────────────────────────────
       HØYRE KOLONNE: Resultattabell
     ───────────────────────────────────────────────────────────────────────── -->
  <div class="col-md-7">
    <h5>Generert tabell</h5>
    <div style="overflow-x:auto;">
      <table id="hoyre-tabell" class="table table-bordered">
        <thead>
          <tr>
            <th>Komponent-ID</th>
            <th>Beskrivelse</th>
            <th>Himlingsskilt</th>
            <th>Stripsskilt</th>
          </tr>
        </thead>
        <tbody>
          <!-- Fylles av JavaScript -->
        </tbody>
      </table>
      <button id="tom-tabell-btn" class="btn btn-warning">Tøm tabell</button>
    </div>
  </div>
</div>

<!-- ───────────────────────────────────────────────────────────────────────────
     3) Knapp‐rad: Scan‐knapp, Generer‐knapp og ny “Generer MC-Dokumentasjon”‐knapp
   ─────────────────────────────────────────────────────────────────────────── -->
<div class="mt-3 mb-3">
  <button id="scan-btn" class="btn btn-secondary">Scan filer og generer</button>
  <button id="generer-btn" class="btn btn-primary">Generer fra tekstlista</button>
  <!-- Den nye knappen: Generer MC‐Dokumentasjon -->
  <button id="generer-mc-btn" class="btn btn-info">Generer MC-Dokumentasjon</button>
</div>

<hr>

<!-- ───────────────────────────────────────────────────────────────────────────
     4) Ordre‐ og utskriftsvalg (uendret fra før)
   ─────────────────────────────────────────────────────────────────────────── -->
<h5>Ordre‐ og utskriftsvalg</h5>
<div class="mb-2">
  <label for="ordrenummer">Ordrenummer (påkrevd):</label>
  <input type="text" id="ordrenummer" class="form-control" placeholder="F.eks. 20230123" required>
</div>

<div class="mb-2">
  <label for="tekniker">Send e‐post/Excel til:</label>
  <select id="tekniker" class="form-control">
    <option value="">Velg tekniker eller admin...</option>
    {% for t in teknikere %}
      <option value="{{ t.id }}">{{ t.navn }}</option>
    {% endfor %}
  </select>
</div>

<div class="mb-2">
  <label for="senest-dato">Senest dato:</label>
  <input type="date" id="senest-dato" class="form-control" required>
</div>

<div class="mb-2">
  <label for="kopi-epost">Kopi av e‐post til (valgfritt):</label>
  <input type="email" id="kopi-epost" class="form-control" placeholder="Din e‐postadresse">
</div>

<button id="send-btn" class="btn btn-success">Send e‐post</button>
<button id="lastned-btn" class="btn btn-secondary">Last ned Excel</button>

<div id="feilmelding" class="text-danger mt-2"></div>

<script src="{{ url_for('static', filename='js/merkeskilt.js') }}"></script>
{% endblock %}